# Vim 搜索替换教程

## 基本搜索

### 向前搜索
```vim
/pattern
```
- 搜索指定的模式
- 按 `n` 跳转到下一个匹配项
- 按 `N` 跳转到上一个匹配项

### 向后搜索
```vim
?pattern
```
- 向后搜索指定的模式
- 按 `n` 跳转到下一个匹配项（向后）
- 按 `N` 跳转到上一个匹配项（向前）

### 搜索当前单词
```vim
*     # 向前搜索光标下的单词
#     # 向后搜索光标下的单词
```

## 基本替换

### 替换语法
```vim
:s/旧文本/新文本/[标志]
```

### 替换当前行
```vim
:s/old/new/        # 替换当前行第一个匹配项
:s/old/new/g       # 替换当前行所有匹配项
:s/old/new/gc      # 替换当前行所有匹配项（需要确认）
```

### 替换指定行
```vim
:5s/old/new/       # 替换第5行第一个匹配项
:5,10s/old/new/g   # 替换第5-10行所有匹配项
```

## 全局替换

### 全文替换
```vim
:%s/old/new/       # 替换整个文件第一个匹配项
:%s/old/new/g      # 替换整个文件所有匹配项
:%s/old/new/gc     # 替换整个文件所有匹配项（需要确认）
:%s/old/new/gi     # 替换整个文件所有匹配项（忽略大小写）
```

### 选定区域替换
```vim
:'<,'>s/old/new/g  # 替换选中区域的所有匹配项
```

## 替换标志

| 标志 | 说明 |
|------|------|
| `g` | 全局替换（替换行中所有匹配项） |
| `c` | 确认替换（每次替换前询问） |
| `i` | 忽略大小写 |
| `I` | 大小写敏感 |
| `e` | 忽略错误 |

## 确认替换选项

当使用 `c` 标志时，Vim会显示以下选项：
- `y` - 是，替换这个匹配项
- `n` - 否，跳过这个匹配项
- `a` - 全部，替换剩余所有匹配项
- `q` - 退出，停止替换
- `l` - 最后一个，替换这个匹配项然后退出
- `^E` - 向下滚动
- `^Y` - 向上滚动

## 正则表达式替换

### 常用正则表达式
```vim
# 匹配任意字符
:%s/./X/g

# 匹配行首
:%s/^/# /g          # 在每行开头添加 "# "

# 匹配行尾
:%s/$/ end/g        # 在每行结尾添加 " end"

# 匹配单词边界
:%s/\<word\>/new/g  # 只匹配完整的单词 "word"

# 匹配数字
:%s/\d\+/NUMBER/g   # 替换所有数字为 "NUMBER"

# 匹配空白字符
:%s/\s\+/ /g        # 将多个空白字符替换为单个空格
```

### 分组和引用
```vim
# 使用分组 \(...\) 和引用 \1, \2 等
:%s/\(hello\) \(world\)/\2 \1/g  # 交换 "hello world" 为 "world hello"

# 将文件名从 file.txt 改为 file_backup.txt
:%s/\(.*\)\.txt/\1_backup.txt/g
```

## 特殊字符处理

### 转义特殊字符
```vim
# 搜索包含特殊字符的文本
:%s/\$/dollar/g     # 替换 $ 符号
:%s/\*/star/g       # 替换 * 符号
:%s/\./dot/g        # 替换 . 符号
:%s/\[/bracket/g    # 替换 [ 符号
```

### 替换换行符
```vim
:%s/\n/ /g          # 将换行符替换为空格
:%s/old\nNew/replaced/g  # 替换跨行的文本
```

### 替换制表符
```vim
:%s/\t/    /g       # 将制表符替换为4个空格
:%s/    /\t/g       # 将4个空格替换为制表符
```

## 高级用法

### 使用变量
```vim
:let old = "pattern"
:let new = "replacement"
:execute "%s/" . old . "/" . new . "/g"
```

### 在多个文件中替换
```vim
:args *.txt         # 加载所有 .txt 文件
:argdo %s/old/new/g # 在所有文件中执行替换
:argdo update       # 保存所有修改的文件
```

### 使用外部命令
```vim
:%!sed 's/old/new/g'  # 使用外部 sed 命令
```

## 实用技巧

### 快速替换光标下的单词
```vim
# 将光标放在要替换的单词上，然后执行：
:%s/<C-r><C-w>/new/g
# <C-r><C-w> 会自动插入光标下的单词
```

### 交互式替换
```vim
# 使用 gn 命令进行可视化替换
/pattern      # 搜索模式
cgn           # 改变下一个匹配项
# 输入新文本
# 按 Esc，然后按 . 重复操作
```

### 保存搜索历史
```vim
:history /    # 查看搜索历史
:history :    # 查看命令历史
```

## 常见错误和解决方案

### E486: Pattern not found
- 检查搜索模式是否正确
- 确认文件中存在要搜索的内容
- 检查大小写是否匹配

### 特殊字符问题
- 使用 `\V` 开启很魔术模式（very magic）
- 使用 `\v` 开启魔术模式（magic）
- 例如：`:%s/\V$/end/g`

### 性能优化
- 对于大文件，考虑使用范围限制
- 使用 `:set hlsearch` 高亮显示搜索结果
- 使用 `:nohlsearch` 或 `:noh` 清除高亮

## 参考资源

- `:help substitute` - Vim 内置帮助
- `:help pattern` - 正则表达式模式帮助
- `:help magic` - 魔术模式说明

# Vim 寄存器教程

## 什么是寄存器

Vim 寄存器是用于存储文本的临时存储空间。每当你复制（yank）、删除（delete）或粘贴（paste）文本时，Vim 都会使用寄存器来存储这些文本。

## 查看寄存器内容

```vim
:registers     # 查看所有寄存器内容
:reg           # 简写形式
:reg a b c     # 查看指定寄存器 a, b, c 的内容
```

## 寄存器类型

### 1. 无名寄存器 (`""`)
- 默认寄存器，最近一次的删除或复制操作
- 当不指定寄存器时使用的默认寄存器

```vim
yy      # 复制当前行到无名寄存器
p       # 粘贴无名寄存器内容
```

### 2. 命名寄存器 (`"a` - `"z`)
- 26个命名寄存器，用小写字母标识
- 手动指定使用的寄存器

```vim
"ayy    # 复制当前行到寄存器 a
"ap     # 粘贴寄存器 a 的内容
"bdd    # 删除当前行到寄存器 b
```

### 3. 大写命名寄存器 (`"A` - `"Z`)
- 追加模式，内容会追加到对应小写寄存器中

```vim
"ayy    # 复制行到寄存器 a
"Ayy    # 追加复制行到寄存器 a（现在 a 包含两行）
```

### 4. 数字寄存器 (`"0` - `"9`)
- 自动管理的删除历史
- `"0` 总是包含最近复制的内容
- `"1` - `"9` 包含最近删除的内容（按时间顺序）

```vim
"0p     # 粘贴最近复制的内容
"1p     # 粘贴最近删除的内容
"2p     # 粘贴倒数第二次删除的内容
```

### 5. 特殊寄存器

#### 小删除寄存器 (`"-`)
```vim
# 存储少于一行的删除内容（单词、字符等）
```

#### 系统剪贴板寄存器 (`"+` 和 `"*`)
```vim
"+yy    # 复制到系统剪贴板（PRIMARY selection）
"+p     # 从系统剪贴板粘贴
"*yy    # 复制到 X11 剪贴板（CLIPBOARD selection）
"*p     # 从 X11 剪贴板粘贴
```

#### 黑洞寄存器 (`"_`)
```vim
"_dd    # 删除行但不存储到任何寄存器
"_x     # 删除字符但不影响其他寄存器
```

#### 文件名寄存器 (`"%`)
```vim
"%p     # 粘贴当前文件名
```

#### 搜索寄存器 (`"/`)
```vim
"/p     # 粘贴最近的搜索模式
```

#### 表达式寄存器 (`"=`)
```vim
"=2+2<CR>p    # 计算表达式并粘贴结果
"=strftime("%Y-%m-%d")<CR>p  # 插入当前日期
```

## 基本操作

### 复制操作 (Yank)
```vim
yy      # 复制当前行
y$      # 复制到行尾
yw      # 复制当前单词
y5j     # 复制当前行及下面5行

# 使用命名寄存器
"ayy    # 复制到寄存器 a
"by$    # 复制到行尾，存储到寄存器 b
```

### 粘贴操作 (Put)
```vim
p       # 在光标后粘贴
P       # 在光标前粘贴
gp      # 粘贴后光标移到粘贴内容后
gP      # 粘贴前光标移到粘贴内容后

# 使用命名寄存器
"ap     # 粘贴寄存器 a 的内容
"bp     # 粘贴寄存器 b 的内容
```

### 删除操作 (Delete)
```vim
dd      # 删除当前行（存储到无名寄存器）
x       # 删除当前字符
dw      # 删除当前单词

# 使用命名寄存器
"add    # 删除当前行到寄存器 a
"bx     # 删除字符到寄存器 b
```

## 可视模式下的寄存器操作

```vim
# 在可视模式下选择文本后
"ay     # 复制选中文本到寄存器 a
"ad     # 删除选中文本到寄存器 a
"ap     # 用寄存器 a 的内容替换选中文本
```

## 插入模式下使用寄存器

```vim
# 在插入模式下
<C-r>a     # 插入寄存器 a 的内容
<C-r>"     # 插入无名寄存器的内容
<C-r>+     # 插入系统剪贴板内容
<C-r>=     # 插入表达式计算结果
```

## 实用技巧

### 1. 交换两行内容
```vim
ddp     # 删除当前行并粘贴到下一行（向下移动行）
ddkP    # 删除当前行并粘贴到上一行（向上移动行）
```

### 2. 使用宏录制结合寄存器
```vim
qa      # 开始录制宏到寄存器 a
# 执行一系列操作
q       # 停止录制
@a      # 播放宏 a
@@      # 重复上次播放的宏
```

### 3. 批量操作
```vim
# 将多个片段存储到不同寄存器，然后批量粘贴
"ayy    # 复制第一行到 a
"byy    # 复制第二行到 b
"cyy    # 复制第三行到 c

# 在需要的地方依次粘贴
"ap
"bp
"cp
```

### 4. 保护重要内容
```vim
# 将重要内容存储到命名寄存器，避免被覆盖
"zyy    # 将重要行存储到寄存器 z
# 进行其他操作...
"zp     # 随时粘贴重要内容
```

### 5. 系统剪贴板集成
```vim
# 设置默认使用系统剪贴板
:set clipboard=unnamedplus

# 或者在 .vimrc 中添加
set clipboard^=unnamed,unnamedplus
```

### 6. 数字寄存器的循环使用
```vim
# 连续粘贴历史删除内容
"1p     # 粘贴最近删除的内容
u       # 撤销
"2p     # 粘贴上一次删除的内容
u       # 撤销
"3p     # 继续循环...
```

## 寄存器在编程中的应用

### 代码片段管理
```vim
# 存储常用代码片段
"ayi{   # 复制整个代码块到寄存器 a
"byy    # 复制导入语句到寄存器 b
"cyy    # 复制注释模板到寄存器 c
```

### 重构代码
```vim
# 使用寄存器进行代码重构
"ayiw   # 复制要重构的变量名到寄存器 a
:%s/<C-r>a/newName/g   # 使用寄存器内容进行全局替换
```

### 多文件编辑
```vim
# 在多个文件间传递内容
"ayy    # 在文件1中复制内容到寄存器 a
:next   # 切换到下一个文件
"ap     # 在文件2中粘贴寄存器 a 的内容
```

## 注意事项

1. **寄存器内容持久性**：寄存器内容在 Vim 会话期间保持，但关闭 Vim 后会丢失
2. **大小写敏感**：`"a` 和 `"A` 是不同的操作模式
3. **覆盖行为**：使用小写寄存器会覆盖原内容，大写寄存器会追加内容
4. **系统剪贴板**：需要 Vim 编译时支持剪贴板功能（`+clipboard`）

## 配置建议

在 `.vimrc` 中添加有用的配置：

```vim
" 设置系统剪贴板为默认
set clipboard^=unnamed,unnamedplus

" 显示寄存器内容的快捷键
nnoremap <leader>r :registers<CR>

" 快速粘贴系统剪贴板
nnoremap <leader>p "+p
vnoremap <leader>p "+p

" 快速复制到系统剪贴板
nnoremap <leader>y "+y
vnoremap <leader>y "+y
```

## 参考命令

```vim
:help registers     # 寄存器帮助文档
:help clipboard     # 剪贴板帮助
:help quote         # 引用寄存器帮助
```
